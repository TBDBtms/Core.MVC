
@{
    ViewData["Title"] = "GetPatient";
    Layout = "~/Views/Home/_Layout.cshtml";
}

<script src="~/lib/jquery/dist/jquery.js"></script>
<script src="~/layui-v2.4.5/layui/layui.js"></script>

<div>
    <div>
        <button type="button" class="layui-btn" style="float:right;margin-right:50px;margin-top:30px;" onclick="location.href ='/Zzh_Patient/AddPatient'">
            <i class="layui-icon">&#xe608;</i> 添加患者
        </button>
    </div>
    </div>
        <div>
            <form class="layui-form">
                <div class="layui-form-item" style="float:left">
                    <label class="layui-form-label">会员类型</label>
                    <div style="width:300px">
                        <div class="layui-input-block">
                            <select name="interest" lay-filter="aihao" id="VIPgrade">
                                <option></option>
                            </select>
                        </div>
                    </div>
                </div>
            </form>
            <div style="float:left">
                <div class="layui-col-xs12 layui-col-sm12 layui-col-md12 layui-col-lg12">
                    <div class="layui-form-item" style="width:300px">
                        <label class="layui-form-label">开始时间：</label>
                        <div class="layui-input-block">
                            <input type="text" id="sTime" name="sTime" model="datetime"
                                   format="yyyy-MM-dd" placeholder="yyyy-MM-dd" autocomplete="off"
                                   class="layui-input test-item" />
                        </div>
                    </div>
                </div>
            </div>
            <div style="float:left">
                <div class="layui-col-xs12 layui-col-sm12 layui-col-md12 layui-col-lg12">
                    <div class="layui-form-item" style="width:300px">
                        <label class="layui-form-label">结束时间：</label>
                        <div class="layui-input-block">
                            <input type="text" id="eTime" name="eTime" model="datetime"
                                   format="yyyy-MM-dd" placeholder="yyyy-MM-dd" autocomplete="off"
                                   class="layui-input test-item" />
                        </div>
                    </div>
                </div>
            </div>
            <div class="layui-input-block" style="width:300px;float:left">
                <input type="text" name="title" lay-verify="title" autocomplete="off" placeholder="患者姓名/手机号" class="layui-input">
            </div>
            <div style="float:left">
                <button type="button" class="layui-btn">查询</button>
            </div>
        </div>
    <div align="center" style="width:1650px;height:1000px">
        <table class="layui-table" style="text-align:center;margin-left:30px">
            <colgroup>
                <col width="150">
                <col width="200">
                <col>
            </colgroup>
            <thead style="background-color:lavender">
            <tr style="background-color: lavender">
                <th style="text-align:center">序号</th>
                <th style="text-align:center">患者编码</th>
                <th style="text-align:center">患者姓名</th>
                <th style="text-align:center">性别</th>
                <th style="text-align:center">年龄</th>
                <th style="text-align:center">手机号码</th>
                <th style="text-align:center">会员等级</th>
                <th style="text-align:center">创建时间</th>
                <th style="text-align:center">操作人员</th>
                <th style="text-align:center">操作</th>
            </tr>
        </thead>
        <tbody id="GetPat">
        </tbody>
      </table>
</div>
               
<script>
    var form;
    var laydate;
    $(function () {
        layui.use('form', function () {
            form = layui.form;
            var layData = ['form', 'laydate'];
            layui.use(layData, function () {
                var laydate = layui.laydate;
                laydate.render({
                    elem: '#sTime'
                });
                laydate.render({
                    elem: '#eTime'
                });
            });
            //监听提交
            form.on('submit(formDemo)', function (data) {
                layer.msg(JSON.stringify(data.field));
                return false;
            });

        });
        ShowVIPType();
    })
    function ShowVIPType() {
        $.ajax({
            url: "http://localhost:4965/api/Zzh_Patient/ZGetVIPgrade",
            type: "get",
            dataType: "json",
            success: function (d) {
                $(d).each(function () {
                    var html = "<option value='" + this.vGradeId + "'>" + this.vGradeName + "</option>";
                    $("#VIPgrade").append(html);
                    form.render('select');
                });
            },
            complete: function () {
                ShowPatient();
            }
        })
    }
   
    function ShowPatient() {
        $.ajax({
            url: "http://localhost:4965/api/Zzh_Patient/GetPatients",
            type: "get",
            dataType: "json",
            success: function (d) {
                $("#GetPat").empty();
                $(d).each(function () {
                    var str = "<tr>" +
                        "<td>" + this.patientId + "</td>" +
                        "<td>" + this.patientCode + "</td>" +
                        "<td>" + this.patientName + "</td>" +
                        "<td>" + (this.patientSex?"男":"女") + "</td>" +
                        "<td>" + this.patientAge + "</td>" +
                        "<td>" + this.patientPhone + "</td>" +
                        "<td style='color:orange'>" + this.vGradeName + "</td>" +
                        "<td>" + this.createTime + "</td>" +
                        "<td>" + this.caoPeople + "</td>" +
                        "<td><a href=''  style='margin-left:10px' onclick=''>接诊</a><a href='' style='margin-left:15px' onclick=''>编辑</a><a href='' style='margin-left:15px' onclick=''>设置会员</a><a href='' style='margin-left:15px' onclick='Del(" + this.patientId + ")'>删除</a></td></tr>";
                    $("#GetPat").append(str);
                });
            }
        });
    }
    function Del(id) {
        confirm("确定要删除吗?")
        {
            $.ajax({
                url: "http://localhost:4965/api/Zzh_Patient/DelPatient?id=" + id,
                type: "post",
                dataType: "json",
                success: function (d) {
                    if (d > 0) {
                        alert("删除成功");
                        location.href = '/Zzh_Patient/GetPatient';
                    }
                    else {
                        alert("删除失败");
                    }
                }
            })
        }
    }
</script>

