
@{
    ViewData["Title"] = "RKSQJC";
    Layout = "~/Views/Home/_Layout.cshtml";
}
<script src="~/lib/jquery/dist/jquery.js"></script>


<table class="layui-table">
    <tr style="background-color:lavender">
        <td>序号</td>
        <td>申请药品名称</td>
        <td>药品图片</td>
        <td>申请数量</td>
        <td>申请时间</td>
        <td>药品类型</td>
        <td>采购价</td>
        <td>零售价</td>
        <td>申请人</td>
        <td>备注</td>
        <td>操作</td>
    </tr>
    <tbody id="tb">

    </tbody>
</table>
<script>
    $(function () {
        init();
    });
    function init() {
        var i = 1;
        var js = sessionStorage.getItem("Rname");
        var pj;
        $.ajax({
            url: "http://localhost:4965/api/ZHQ_RK/GetRKSQ",
            data: {},
            type: "get",
            dataType: "json",
            success: function (d) {
                $(d).each(function () {
                    if (js == "入库员" && this.rksqState == 1) {
                        var str = "<tr>" +
                            "<td>" + i + "</td>" +
                            "<td>" + this.rksqypName + "</td>" +
                            "<td><img src='" + this.rksqImg + "' style='height:50px;width:50px'/></td>" +
                            "<td>" + this.rksqNum + "</td>" +
                            "<td>" + this.gtime + "</td>" +
                            "<td>" + this.rksqlx + "</td>" +
                            "<td>" + this.rksqcgj + "</td>" +
                            "<td>" + this.rksqlsj + "</td>" +
                            "<td>" + this.rksqName + "</td>" +
                            "<td>" + this.rksqDesc + "</td>" +
                            "<td><a style='color:blue' href='#' onclick='SQTG(" + this.rksqId + ",2)'>通过</a>&nbsp;&nbsp;<a href='#' style='color:blue'>拒绝</a></td>" +
                            "</tr>";
                        $("#tb").append(str);
                        i++;
                    }
                    else if (js == "仓管" && this.rksqState == 2) {
                        var str = "<tr>" +
                            "<td>" + i + "</td>" +
                            "<td>" + this.rksqypName + "</td>" +
                            "<td><img src='" + this.rksqImg + "' style='height:50px;width:50px'/></td>" +
                            "<td>" + this.rksqNum + "</td>" +
                            "<td>" + this.gtime + "</td>" +
                            "<td>" + this.rksqlx + "</td>" +
                            "<td>" + this.rksqcgj + "</td>" +
                            "<td>" + this.rksqlsj + "</td>" +
                            "<td>" + this.rksqName + "</td>" +
                            "<td>" + this.rksqDesc + "</td>" +
                            "<td><a style='color:blue' href='#' onclick='SQTG(" + this.rksqId + ",3)'>通过</a>&nbsp;&nbsp;<a href='#' style='color:blue'>拒绝</a></td>" +
                            "</tr>";
                        $("#tb").append(str);
                        i++;
                    }
                    else if (js == "质检员" && this.rksqState == 3) {
                        var str = "<tr>" +
                            "<td>" + i + "</td>" +
                            "<td>" + this.rksqypName + "</td>" +
                            "<td><img src='" + this.rksqImg + "' style='height:50px;width:50px'/></td>" +
                            "<td>" + this.rksqNum + "</td>" +
                            "<td>" + this.gtime + "</td>" +
                            "<td>" + this.rksqlx + "</td>" +
                            "<td>" + this.rksqcgj + "</td>" +
                            "<td>" + this.rksqlsj + "</td>" +
                            "<td>" + this.rksqName + "</td>" +
                            "<td>" + this.rksqDesc + "</td>" +
                            "<td><a style='color:blue' href='#' onclick='AddRK(" + this + ")'>通过</a>&nbsp;&nbsp;<a href='#' style='color:blue'>拒绝</a></td>" +
                            "</tr>";
                        $("#tb").append(str);
                        i++;
                    }
                })
            }
        })
    }


    function SQTG(id, tgstate) {
        $.ajax({
            url: "http://localhost:4965/api/ZHQ_RK/UpdState",
            data: { id: id, tgstate: tgstate},
            type: "get",
            dataType: "json",
            success: function (d) {
                if (d > 0) {
                    alert('操作成功');
                    init();
                } else {
                    alert('操作失败')
                }
            }
        })
    }

    function AddRK(dou) {

    }
</script>